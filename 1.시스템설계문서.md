# HyurimBot 시스템 설계 문서

## 프로젝트 개요

### 1. 프로젝트명
**HyurimBot - AI 기반 자연휴양림 추천 시스템**

### 2. 프로젝트 목표
- RAG(Retrieval-Augmented Generation) 기술을 활용한 개인화 숙박시설 추천
- 한국어 특화 BERT 모델과 FAISS 벡터 검색을 통한 의미적 유사도 기반 추천
- 전국 199개 자연휴양림의 숙박시설 데이터 자동 수집 및 관리
- 할인정책 반영한 개인화 가격 계산 시스템

### 3. 핵심 기능 요구사항
- **데이터 수집**: Playwright 기반 자동 웹 크롤링
- **AI 추천**: 한국어 BERT + FAISS 벡터 검색
- **개인화**: 사용자 프로필 기반 선호도 매칭
- **관리 도구**: Flask 기반 관리자 대시보드
- **사용자 인터페이스**: Streamlit 기반 직관적 추천 서비스

## 시스템 아키텍처

### 1. 전체 시스템 구조도

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           HyurimBot AI 추천 시스템                           │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌──────────────────┐    ┌─────────────────────┐
│   데이터 수집    │    │    데이터 저장    │    │    AI 처리 엔진     │
│   (Playwright)   │───▶│   (SQLite DB)    │───▶│  (BERT + FAISS)     │
│                 │    │  - 14개 정규화    │    │  - 임베딩 생성      │
│ • 웹 크롤링      │    │    테이블         │    │  - 벡터 검색        │
│ • 데이터 정제    │    │  - 93+ 숙박시설   │    │  - 유사도 계산      │
│ • 실시간 업데이트 │    │  - UTF-8 지원     │    │  - 개인화 필터링    │
└─────────────────┘    └──────────────────┘    └─────────────────────┘
         │                        │                        │
         ▼                        ▼                        ▼
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────────┐
│  관리자 인터페이스│    │   공유 서비스     │    │   사용자 인터페이스  │
│    (Flask)      │    │                  │    │   (Streamlit)       │
│                 │    │ • 데이터베이스    │    │                     │
│ • 크롤링 제어    │◄──┤   연결 관리       │──▶ │ • 검색 인터페이스    │
│ • 데이터 모니터링 │    │ • 설정 관리       │    │ • 추천 결과 표시    │
│ • 할인정책 관리   │    │ • 로깅 시스템     │    │ • 사용자 프로필     │
└─────────────────┘    └──────────────────┘    └─────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                        외부 데이터 소스                                      │
│  • 전국 자연휴양림 표준데이터(csv) (data.go.kr      )                        │
│  • 산림청 자연휴양림 공식 웹사이트 (foresttrip.go.kr)                        │
│  • 199개 휴양림 숙박시설 정보                                                 │
│  • 할인정책 및 예약규정                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2. 데이터 파이프라인 구조

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   원본 데이터    │    │   전처리 단계    │    │   구조화 저장    │
│                │    │                │    │                │
│ • HTML 웹페이지  │───▶│ • 텍스트 추출    │───▶│ • SQLite DB     │
│ • 동적 JavaScript│    │ • 데이터 정규화   │    │ • 정규화 테이블  │
│ • 팝업 모달      │    │ • 한국어 처리    │    │ • 인덱스 최적화  │
│ • 이미지/첨부파일 │    │ • 유효성 검증    │    │ • 외래키 제약조건 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                        │                        │
         ▼                        ▼                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   특성 엔지니어링 │    │   벡터화 처리    │    │   검색 인덱스    │
│                │    │                │    │                │
│ • 텍스트 결합    │───▶│ • BERT 임베딩    │───▶│ • FAISS 인덱스   │
│ • 수치 정규화    │    │ • 768차원 벡터   │    │ • 코사인 유사도  │
│ • 범주형 인코딩   │    │ • L2 정규화      │    │ • 실시간 검색    │
│ • 결측값 처리    │    │ • 배치 처리      │    │ • 캐시 최적화    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 3. AI 모델 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AI 추천 엔진 아키텍처                                  │
└─────────────────────────────────────────────────────────────────────────────┘

    사용자 쿼리
         │
         ▼
┌─────────────────┐
│   쿼리 전처리    │  • 한국어 형태소 분석
│                │  • 의도 파악 (인원, 지역, 테마)
│ • 텍스트 정규화  │  • 키워드 추출 및 보강
│ • 의도 추출      │  • 오타 보정
│ • 컨텍스트 보강  │
└─────────────────┘
         │
         ▼
┌─────────────────┐
│ 한국어 BERT 임베딩│  • jhgan/ko-sroberta-multitask
│                │  • Sentence-Transformers
│ • 768차원 벡터   │  • 의미적 유사도 계산
│ • L2 정규화      │  • 다국어 지원
│ • 배치 처리      │
└─────────────────┘
         │
         ▼
┌─────────────────┐
│  FAISS 벡터검색  │  • IndexFlatIP (Inner Product)
│                │  • 코사인 유사도 기반
│ • 고속 검색 <10ms│  • 93+ 숙박시설 대상
│ • Top-K 검색    │  • 실시간 필터링
│ • 메모리 효율적   │
└─────────────────┘
         │
         ▼
┌─────────────────┐
│   개인화 필터링   │  • 사용자 프로필 매칭
│                │  • 할인 자격 계산
│ • 가격대 필터    │  • 지역 선호도
│ • 인원수 매칭    │  • 시설 유형 선호
│ • 할인 적용      │
└─────────────────┘
         │
         ▼
    추천 결과 리스트
```

## 데이터베이스 설계

### 1. ERD (Entity Relationship Diagram)

```
┌─────────────────┐    1:N    ┌─────────────────┐
│     forests     │──────────▶│ accommodations  │
│                 │           │                 │
│ • forest_id (PK)│           │ • accommodation_id (PK)
│ • forest_name   │           │ • forest_id (FK)│
│ • sido          │           │ • facility_name │
│ • address       │           │ • capacity_std  │
│ • phone         │           │ • price_weekday │
│ • homepage_url  │           │ • amenities     │
└─────────────────┘           └─────────────────┘
         │                              │
         │1:N                          │1:N
         ▼                              ▼
┌─────────────────┐           ┌─────────────────┐
│   facilities    │           │ discount_policies│
│                 │           │                 │
│ • facility_id   │           │ • discount_id   │
│ • forest_id (FK)│           │ • forest_id (FK)│
│ • facility_name │           │ • target_group  │
│ • facility_type │           │ • discount_rate │
│ • description   │           │ • conditions    │
└─────────────────┘           └─────────────────┘
```

### 2. 주요 테이블 스키마

#### 2.1 forests (자연휴양림 마스터 테이블)
```sql
CREATE TABLE forests (
    forest_id TEXT PRIMARY KEY,           -- 휴양림 고유 ID
    forest_name TEXT NOT NULL,            -- 휴양림명
    sido TEXT NOT NULL,                   -- 시도
    location_road TEXT,                   -- 도로명주소
    phone TEXT,                           -- 전화번호
    homepage_url TEXT,                    -- 홈페이지 URL
    main_facilities TEXT,                 -- 주요시설
    forest_type TEXT,                     -- 휴양림구분
    accommodation_available TEXT,         -- 숙박가능여부
    latitude REAL,                        -- 위도
    longitude REAL,                       -- 경도
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 2.2 accommodations (숙박시설 테이블)
```sql
CREATE TABLE accommodations (
    accommodation_id INTEGER PRIMARY KEY AUTOINCREMENT,
    forest_id TEXT NOT NULL,              -- 휴양림 ID
    facility_name TEXT NOT NULL,          -- 시설명
    facility_type TEXT,                   -- 시설유형
    capacity_standard INTEGER,            -- 기준인원
    capacity_maximum INTEGER,             -- 최대인원
    area REAL,                           -- 면적(㎡)
    checkin_time TEXT,                   -- 입실시간
    checkout_time TEXT,                  -- 퇴실시간
    price_off_weekday INTEGER,           -- 비수기평일요금
    price_peak_weekend INTEGER,          -- 성수기주말요금
    amenities TEXT,                      -- 편의시설
    usage_info TEXT,                     -- 이용안내
    booking_rules TEXT,                  -- 예약규칙
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (forest_id) REFERENCES forests(forest_id)
);
```

### 3. 인덱스 최적화 전략

```sql
-- 검색 성능 최적화를 위한 인덱스
CREATE INDEX idx_accommodations_forest_id ON accommodations(forest_id);
CREATE INDEX idx_accommodations_capacity ON accommodations(capacity_standard);
CREATE INDEX idx_accommodations_price ON accommodations(price_off_weekday);
CREATE INDEX idx_forests_sido ON forests(sido);
CREATE INDEX idx_facilities_forest_id ON facilities(forest_id);
```

## API 설계

### 1. REST API 엔드포인트

#### 1.1 관리자 API
```
GET  /api/forests                    # 휴양림 목록 조회
GET  /api/accommodations             # 숙박시설 목록 조회
GET  /api/facilities                 # 편의시설 목록 조회
POST /api/crawl/basic               # 기본 데이터 크롤링 실행
POST /api/crawl/detailed            # 상세 데이터 크롤링 실행
POST /api/crawl/discount-policies   # 할인정책 크롤링 실행
```

#### 1.2 추천 API
```
POST /api/recommend                 # AI 추천 요청
GET  /api/accommodation/{id}        # 숙박시설 상세 정보
POST /api/search                    # 키워드 검색
GET  /api/stats                     # 시스템 통계 정보
```

### 2. API 요청/응답 스키마

#### 2.1 AI 추천 요청
```json
{
  "query": "4인 가족 넓은 객실",
  "preferences": {
    "capacity": 4,
    "price_max": 150000,
    "location": "제주",
    "facility_type": "펜션",
    "top_k": 10
  },
  "user_profile": {
    "discount_eligibility": ["다자녀가정"],
    "previous_bookings": []
  }
}
```

#### 2.2 AI 추천 응답
```json
{
  "success": true,
  "query": "4인 가족 넓은 객실",
  "total_results": 8,
  "execution_time_ms": 245,
  "recommendations": [
    {
      "accommodation_id": 1,
      "facility_name": "숲속의초가 1",
      "forest_name": "교래자연휴양림",
      "facility_type": "초가동",
      "capacity_standard": 6,
      "price_off_weekday": 75000,
      "discounted_price": 52500,
      "similarity_score": 0.892,
      "recommendation_reason": "높은 유사도 | 가족 친화적 | 할인 적용",
      "amenities": "에어컨, TV, 냉장고, 취사용품",
      "location": {
        "sido": "제주특별자치도",
        "address": "제주시 조천읍 교래리 산 1-1"
      }
    }
  ]
}
```

## 핵심 기술 스택

### 1. AI/ML 기술
- **임베딩 모델**: jhgan/ko-sroberta-multitask (한국어 특화)
- **벡터 검색**: FAISS IndexFlatIP (코사인 유사도)
- **자연어 처리**: sentence-transformers, konlpy
- **수치 연산**: numpy, scipy

### 2. 백엔드 기술
- **웹 프레임워크**: Flask 2.3+
- **데이터베이스**: SQLite (개발), PostgreSQL (배포)
- **웹 크롤링**: Playwright 1.40+
- **API 문서화**: Flask-RESTX (Swagger)

### 3. 프론트엔드 기술
- **사용자 UI**: Streamlit 1.28+
- **관리자 UI**: Bootstrap 5 + JavaScript ES6
- **시각화**: Plotly, matplotlib
- **스타일링**: CSS Grid, Flexbox

### 4. 인프라 및 배포
- **컨테이너**: Docker, docker-compose
- **CI/CD**: GitHub Actions
- **모니터링**: 커스텀 로깅 시스템
- **캐싱**: 파일 기반 임베딩 캐시

## 성능 설계 목표

### 1. 응답 시간 목표
- **벡터 검색**: < 10ms (93개 시설 기준)
- **전체 추천**: < 500ms (쿼리 → 결과)
- **임베딩 생성**: < 100ms (단일 문서)
- **웹 크롤링**: < 3초 (단일 페이지)

### 2. 메모리 사용량
- **FAISS 인덱스**: ~50MB (93개 시설, 768차원)
- **BERT 모델**: ~400MB (모델 로딩 시)
- **전체 시스템**: ~600MB (피크 사용량)

### 3. 정확도 목표
- **Precision@5**: > 0.85 (상위 5개 추천 정확도)
- **사용자 만족도**: > 4.0/5.0 (설문 기준)
- **클릭률**: > 60% (추천 결과 클릭률)

## 보안 및 안정성

### 1. 데이터 보안
- **SQL Injection 방지**: 매개변수화 쿼리 사용
- **XSS 방지**: 입력값 이스케이핑
- **CSRF 방지**: Flask-WTF CSRF 토큰
- **입력 검증**: Pydantic 스키마 검증

### 2. 시스템 안정성
- **오류 처리**: 단계별 try-catch 처리
- **로그 관리**: 구조화된 로깅 시스템
- **백업 전략**: 데이터베이스 정기 백업
- **모니터링**: 시스템 리소스 모니터링

### 3. 확장성 고려사항
- **캐싱 전략**: 임베딩 벡터 파일 캐시
- **인덱스 최적화**: 쿼리 성능 최적화
- **부하 분산**: 필요시 로드밸런서 도입
- **데이터베이스 확장**: PostgreSQL 마이그레이션 준비

## 향후 확장 계획

### 1. 단기 계획 (3개월)
- 전국 199개 휴양림 완전 데이터 수집
- 할인정책 완전 통합
- Streamlit UI 완성
- 성능 최적화

### 2. 중기 계획 (6개월)
- GPT API 연동 자연어 생성
- 다중 임베딩 모델 지원
- 실시간 가격 업데이트
- 모바일 앱 개발

### 3. 장기 계획 (1년)
- 다른 숙박 플랫폼 연동
- 개인화 학습 알고리즘
- 실시간 채팅 지원
- 예약 시스템 통합

---

**문서 버전**: 1.0  
**작성일**: 2025년 9월 11일  
**작성자**: HyurimBot 개발팀